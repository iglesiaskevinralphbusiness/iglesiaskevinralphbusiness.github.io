<html>

<head>
	<title>React JS - Functional</title>
	<link href="common/css/reset.css" rel="stylesheet" />
	<link href="common/css/style.css" rel="stylesheet" />
	<link href="common/css/media.css" rel="stylesheet" />
	
	<link rel="stylesheet" href="libs/tinymace/prism.css">
	
	<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
</head>

<body>
<div class="content" id="top">
<!--Write your content here-->
<h1>Next JS</h1>

<h2>Install</h2>
<div class="divBlock">
	<h3 id="h3-1">By react app</h3>
	<p>npm create react-app app-name --template next</p>

	<h3 id="h3-1">By next</h3>
	<p>npx create-next-app</p>
	<p>npm install</p>
	<p>npm run dev</p>
</div>

<h2>Pages routing</h2>
<div class="divBlock">
	<h3 id="h3-1">Filename</h3>
	<p>/ → pages/index.js</p>
	<p>/about → pages/about.js</p>
	<p>/blog/hello-world → pages/blog/[identifierId].js</p>
	
	<h3 id="h3-1">Folder file name as identifier</h3>
	<p>/any-title  →  pages/[identifierId]/index.js</p>
	<p>/any-title/view  →  pages/[identifierId]/view.js</p>
</div>

<h2>Link</h2>
<div class="divBlock">
	<pre><code class="language-javascript">import Link from 'next/link';

&lt;Link href="/">Home&lt;/Link></code></pre>
</div>

<h2>Layout</h2>
<div class="divBlock">
	<h3 id="h3-1">/components/layout.js</h3>
	<pre><code class="language-javascript">function Layout(props){
	return (
		&lt;div>
			&lt;nav>
				&lt;ul>
					&lt;li>Home&lt;/li>
					&lt;li>Account&lt;/li>
					&lt;li>Contact us&lt;/li>
				&lt;/ul>
			&lt;/nav>
			&lt;main>{props.children}&lt;/main>
		&lt;/div>
	)
}</code></pre>

	<h3 id="h3-1">global -> /pages/_app.js</h3>
	<pre><code class="language-javascript">import Layout from 'layout';
		
function MyApp({ Component, pageProps }) {
	return &lt;Layout>
		&lt;Component {...pageProps} />
	&lt;/Layout>;
}</code></pre>


	<h3 id="h3-1">or using individual page</h3>
	<pre><code class="language-javascript">import Layout from 'layout';

return {
	&lt;Layout>
		&lt;div>
			...
		&lt;/div>
	&lt;/Layout>
}</code></pre>
</div>

<h2>Pre-rendering Functions</h2>
<div class="divBlock">
	<h3 id="h3-1">getStaticProps</h3>
	<p>source: <a href="https://betterprogramming.pub/how-to-choose-data-fetching-strategies-in-nextjs-dadabf45e562">https://betterprogramming.pub/how-to-choose-data-fetching-strategies-in-nextjs-dadabf45e562</a></p>
	<p>To populate the data from api, let's say <b>list of products</b></p>
	<pre><code class="language-javascript">export default function Products(props) { ... }
		
export async function getStaticProps(context: GetStaticPropsContext) {
	const res = await fetch('http://localhost:3000/api/products')
	const products = await res.json()

	return {
		props: {
			products
		}
	};
}</code></pre>
	<p>To set a refresh interval api request, add the revalidate</p>
	<pre><code class="language-javascript">export default function Products(props) { ... }
		
export async function getStaticProps(context: GetStaticPropsContext) {
	const res = await fetch('http://localhost:3000/api/products')
	const products = await res.json()

	return {
		props: {
			products,
		},
		revalidate: 10, //every 10 seconds
	};
}</code></pre>

	<h3 id="h3-1">getStaticPaths</h3>
	<p>source: <a href="https://medium.com/@remoteupskill/understanding-getstaticpaths-in-next-js-in-under-5-mins-df0e09abd95e">https://medium.com/@remoteupskill/understanding-getstaticpaths-in-next-js-in-under-5-mins-df0e09abd95e</a></p>
	<p>Ginagamit natin ang getStaticPaths para sa mga pages tulad ng <b>productDetails</b> or <b>/product-details?id=1</b> na page</p>
	<p>at sa pamamagitan nito nakukuha natin ang detalye ng product at naveverify kung ito ay invalid id</p>
	
	
	
	<pre><code class="language-javascript">export default function ProductDetails(props) { ... }
	
export async function getStaticPaths() {
	//get products
	const res = await fetch('http://localhost:3000/api/products')
	const products = await res.json()
	
	//ger product id list
	const idList = products.map(product => product.id)

	//convert them into params
	const params = idList.map(id => ({params: {productId: id}}))
	
	return {
			fallback: 'blocking', 
			paths: params,
	};
}

export async function getStaticProps(context) {
	// we have the productId inside the params of context
	const {params} = context
	const productId = params.productId

	//use that productId to get details
	const res = await fetch('http://localhost:3000/api/productDetails?id=' + productId)
	const productDetails = await res.json()

	return {
			props: { productDetails }
	};
}

export default ProductDetails</code></pre>


	<p>If you call an api for products and you want to get the details of all products by there ID using api, thats where you can use getStaticPaths.</p>
	<pre><code class="language-javascript"></code></pre>

	<h3 id="h3-1">getServerSideProps</h3>
	<p>Ginagamit naman ito kapag meron kang gusto munang ivalidate sa page.</p>
	<p>Remember one thing: If you use getServerSideProps, it will not pre-generate any page like getStaticPaths. Instead, it will run the code inside the getServerSideProps every time the page is requested.</p>
	<pre><code class="language-javascript">export async function getServerSideProps(context: GetServerSidePropsContext) {
	const {params} = context

	if(!params?.id){
		return {
			props: {}
		}
	}
}</code></pre>
</div>

<h2>NextJs and Prisma</h2>
<div class="divBlock">
	<p><a href="https://www.youtube.com/watch?v=quNLtK7hWYs">https://www.youtube.com/watch?v=quNLtK7hWYs</a></p>
</div>

<h2>API</h2>
<div class="divBlock">
	<h3 id="h3-1">Get</h3>
	<pre><code class="language-javascript">export default function handler(req, res) {
	if (req.method === 'GET') {
		// Your logic to fetch data goes here
		const data = { message: 'This is a GET request' };
		
		// Return the fetched data as JSON response
		res.status(200).json(data);
	} else {
		// Return 405 Method Not Allowed for non-GET requests
		res.status(405).json({ message: 'Method Not Allowed' });
	}
}</code></pre>

	<h3 id="h3-1">Post</h3>
	<pre><code class="language-javascript">export default function handler(req, res) {
	if (req.method === 'POST') {
		// Retrieve data from the request body
		const { name, email } = req.body;

		// Your logic to process the POST data goes here
		// For example, you could save the data to a database
		
		// Return a success message
		const message = `Data received: Name - ${name}, Email - ${email}`;
		res.status(200).json({ message });
		//200: “Everything is OK.” This is the code that is delivered when a web page or resource acts exactly the way it's expected to.
		//201: “Created.” The server has fulfilled the browser's request, and as a result, has created a new resource. That means for insert or update, use 201.
	} else {
		// Return 405 Method Not Allowed for non-POST requests
		res.status(405).json({ message: 'Method Not Allowed' });
	}
}</code></pre>
</div>

<h2>API Token-Based Authentication</h2>
<div class="divBlock">
	<h3 id="h3-1">Install JsonWebToken</h3>
	<p>npm install jsonwebtoken</p>

	<h3 id="h3-1">Middleware for API</h3>
	<p><strong>middleware/auth.js</strong></p>
	<pre><code class="language-javascript">import jwt from 'jsonwebtoken';

export default function authMiddleware(req, res, next) {
	// Extract token from request headers, cookies, or query parameters
	const token = req.headers.authorization?.split(' ')[1]; // Assuming token is sent in the Authorization header

	// Verify token
	try {
		const decoded = jwt.verify(token, process.env.JWT_SECRET);
		req.user = decoded; // Attach user information to the request object
		next();
	} catch (error) {
		return res.status(401).json({ message: 'Unauthorized' });
	}
}</code></pre>

	<h3 id="h3-1">Implement Middleware in Login</h3>
	<p>sample login user <strong>pages/api/login.js</strong></p>
	<pre><code class="language-javascript">import jwt from 'jsonwebtoken';

export default function handler(req, res) {
	if (req.method !== 'POST') {
		return res.status(405).json({ message: 'Method Not Allowed' });
	}

	// Validate user credentials (e.g., username and password)
	const { username, password } = req.body;
	if (isValidUserCredentials(username, password)) {
		// Generate JWT token
		const token = jwt.sign({ username }, process.env.JWT_SECRET, { expiresIn: '1h' });

		// Return token to the client
		res.status(200).json({ token });
	} else {
		res.status(401).json({ message: 'Invalid credentials' });
	}
}</code></pre>

	<h3 id="h3-1">Implement Middleware in API</h3>
	<p>sample get data <strong>pages/api/get-user.js</strong></p>
	<pre><code class="language-javascript">import authMiddleware from '../../middleware/auth';

export default function handler(req, res) {
	if (req.method !== 'GET') {
		return res.status(405).json({ message: 'Method Not Allowed' });
	}

	// Apply authentication middleware to protect the route
	authMiddleware(req, res, () => {
		// Access user information from req.user
		const userId = req.user.userId;

		// Perform actions based on user ID
		// Example: Fetch user data from the database
		const userData = fetchUserData(userId);

		res.status(200).json(userData);
	});
}</code></pre>
</div>

<h2>API Rate Limit / Anti-spam</h2>
<div class="divBlock">
	<p>These middleware allow you to limit the number of requests a client can make to your API within a certain time frame.</p>
	<p>With this setup, requests to the rateLimitedRoute API endpoint will be rate-limited to 100 requests per minute per IP address.<br>
		If a client exceeds this limit, they will receive a "Too many requests" response with a <strong>status code of 429</strong> (Too Many Requests).</p>

	<h3 id="h3-1">Install</h3>
	<p>npm install express-rate-limit</p>

	<h3 id="h3-1">Middleware for API</h3>
	<p>middleware/rateLimit.js</p>
	<pre><code class="language-javascript">import rateLimit from 'express-rate-limit';

const limiter = rateLimit({
	windowMs: 60 * 1000, // 1 minute
	max: 100, // limit each IP to 100 requests per windowMs
	message: 'Too many requests from this IP, please try again later'
}); //status code is 429 (Too Many Requests).

export default limiter;</code></pre>

	<h3 id="h3-1">Implement Middleware in API</h3>
	<pre><code class="language-javascript">import limiter from '../../middleware/rateLimit';

export default function handler(req, res) {
	// Apply rate limiting middleware to the route
	limiter(req, res, () => {
		// Your route logic goes here
		res.status(200).json({ message: 'This is a rate-limited route' });
	});
}</code></pre>

	<h3 id="h3-1">Implement both authentication and limiter</h3>
	<pre><code class="language-javascript">import authMiddleware from '../../middleware/auth';
		import limiter from '../../middleware/rateLimit';
		
export default function handler(req, res) {
	// Apply rate limiting middleware to the route
	limiter(req, res, () => {
		// Apply authentication middleware to the route
		authMiddleware(req, res, () => {
			// Your route logic goes here
			res.status(200).json({ message: 'This is a protected route' });
		});
	});
}</code></pre>
</div>

<h2>API Validation</h2>
<div class="divBlock">
	<h3 id="h3-1">Install</h3>
	<p>npm install express-validator</p>

	<h3 id="h3-1">Middleware for API</h3>
	<pre><code class="language-javascript">import { validationResult } from 'express-validator';

export default function validate(req, res, next) {
	const errors = validationResult(req);
	if (!errors.isEmpty()) {
		return res.status(400).json({ errors: errors.array() });
	}
	next();
}</code></pre>

	<h3 id="h3-1">Implement Validation</h3>
	<p>// pages/api/submitForm.js</p>
	<pre><code class="language-javascript">import { body } from 'express-validator';
import validate from '../../middleware/validate';

export const formValidationRules = [
	body('name').notEmpty().withMessage('Name is required'),
	body('email').isEmail().withMessage('Email must be valid'),
	body('age').isLength({ min: 1, max: 50 }).withMessage('Field must be between 2 and 50 characters'),
	body('age').isInt().withMessage('Field must be an integer'),
	body('male').isBoolean().withMessage('Field must be a boolean'),
	body('url').isURL().withMessage('Field must be a valid URL'),
	body('password').matches(/^[a-zA-Z0-9_]+$/).withMessage('Field must contain only letters, numbers, or underscores'),
	body('date').isAfter('2022-01-01').withMessage('Field must be after 2022-01-01'),
	body('hobies').isIn(['value1', 'value2', 'value3']).withMessage('Field must be one of value1, value2, value3'),
	// Add more validation rules as needed
];

export default function handler(req, res) {
	// Apply validation middleware with formValidationRules
	validate(formValidationRules)(req, res, () => {
		// Your route logic goes here
		res.status(200).json({ message: 'Form submitted successfully' });
	});
}</code></pre>
</div>

<h2>Error Handling</h2>
<div class="divBlock">
	<h3 id="h3-1">API error handling</h3>
	<p>middleware/errorHandler.js</p>
	<pre><code class="language-javascript">export default function errorHandler(err, req, res, next) {
	console.error('Error:', err.message);
	res.status(500).json({ message: 'Internal Server Error' });
}</code></pre>

	<h3 id="h3-1">Implement API error handling</h3>
	<p>pages/api/example.js</p>
	<pre><code class="language-javascript">import errorHandler from '../../middleware/errorHandler';

export default function handler(req, res) {
	try {
		// Your route logic goes here
		throw new Error('Example error');
	} catch (error) {
		next(error); // Pass the error to the errorHandler middleware
	}
}</code></pre>

	<h3 id="h3-1">Implement Pages error handling</h3>
	<p>pages/_error.js</p>
	<pre><code class="language-javascript">function Error({ statusCode }) {
	return (
		<p>
			{statusCode
				? `An error ${statusCode} occurred on the server`
				: 'An error occurred on the client'}
		</p>
	);
}

Error.getInitialProps = ({ res, err }) => {
	const statusCode = res ? res.statusCode : err ? err.statusCode : 404;
	return { statusCode };
};

export default Error;</code></pre>
</div>

<h2>API Pagination with mongodb</h2>
<div class="divBlock">
	<pre><code class="language-javascript">// pages/api/users.js

import connectDB from '../../utils/dbConnect';
import User from '../../models/User';

export default async function handler(req, res) {
	// Connect to MongoDB
	await connectDB();

	// Pagination parameters
	const page = parseInt(req.query.page) || 1;
	const pageSize = parseInt(req.query.pageSize) || 10;

	try {
		// Fetch total count of users (for calculating total pages)
		const totalCount = await User.countDocuments();

		// Calculate total pages based on total count and page size
		const totalPages = Math.ceil(totalCount / pageSize);

		// Fetch paginated users from MongoDB
		const users = await User.find()
			.skip((page - 1) * pageSize)
			.limit(pageSize)
			.exec();

		// Return paginated data in the API response
		res.status(200).json({
			users,
			pagination: {
				page,
				pageSize,
				totalPages,
				totalCount
			}
		});
	} catch (error) {
		res.status(500).json({ message: 'Internal Server Error' });
	}
}</code></pre>
</div>

<h2>CORS (Cross-Origin Resource Sharing)</h2>
<div class="divBlock">
	<h3 id="h3-1">Middleware for API</h3>
	<p>middleware/cors.js</p>
	<pre><code class="language-javascript">export default function cors(req, res, next) {
	res.setHeader('Access-Control-Allow-Origin', '*');
	res.setHeader('Access-Control-Allow-Methods', 'GET, POST, PUT, PATCH, DELETE, OPTIONS');
	res.setHeader('Access-Control-Allow-Headers', 'Origin, X-Requested-With, Content-Type, Accept');
	res.setHeader('Access-Control-Allow-Credentials', 'true');

	if (req.method === 'OPTIONS') {
		// Pre-flight request
		res.status(200).end();
		return;
	}

	next();
}</code></pre>

	<h3 id="h3-1">Implement middleware to API</h3>
	<pre><code class="language-javascript">import cors from '../../middleware/cors';

export default function handler(req, res) {
	// Apply CORS middleware to the route
	cors(req, res, () => {
		// Your route logic goes here
		res.status(200).json({ message: 'This is an example route' });
	});
}</code></pre>
</div>

<h2>Web Socket</h2>
<div class="divBlock">
	<h3 id="h3-1">Installation</h3>
	<p>For API</p>
	<p>npm install socket.io socket.io-express</p>
	<p>For Client-sider</p>
	<p>npm install socket.io-client</p>

	<h3 id="h3-1">Server Config For API</h3>
	<p>/config/websocket.config.js</p>
	<pre><code class="language-javascript">import { Server } from 'socket.io';
import { createServer } from 'http';
		
const startWebSocketServer = () => {
	const httpServer = createServer();
	const io = new Server(httpServer);

	io.on('connection', (socket) => {
		console.log('Client connected');

		socket.on('disconnect', () => {
			console.log('Client disconnected');
		});
	});

	httpServer.listen(3001, () => {
		console.log('WebSocket server started at http://localhost:3001');
	});

	return io;
};

export default startWebSocketServer;</code></pre>

	<h3 id="h3-1">API</h3>
	<pre><code class="language-javascript">import startWebSocketServer from '../config/websocket.config.js';

const io = startWebSocketServer();

export default function handler(req, res) {
	if (req.method === 'POST') {
		const objectItem = {
			id: 1,
			username: 'kevin'
		}

		// Emit the objectItem to connected clients
		io.emit('objectItem', objectItem);

		res.status(200).json({ message: 'ObjectItem emitted successfully' });
	} else {
		res.status(405).json({ message: 'Method Not Allowed' });
	}
}</code></pre>

	<h3 id="h3-1">Server Config For API</h3>
	<p>/index.js</p>
	<pre><code class="language-javascript">import { useEffect } from 'react';
		import io from 'socket.io-client';
		
		const YourComponent = () => {
			useEffect(() => {
				const socket = io('http://localhost:3001'); // Adjust URL based on your server setup
		
				// Listen for the 'objectItem' event emitted from the server
				socket.on('objectItem', (data) => {
					console.log('Received objectItem:', data);
					// Handle the received data as needed
				});
		
				// Clean up the socket connection
				return () => {
					socket.disconnect();
				};
			}, []);
		
			return <div>Your Component</div>;
		};
		
		export default YourComponent;</code></pre>
</div>

<!--END write your content here-->
</div>
<p class="goTop"><a href="#top">TOP</a></p>
</body>

<script type="text/javascript" src="common/js/jquery.js"></script>
<script type="text/javascript" src="common/js/script.js"></script>
<script type="text/javascript" src="common/js/smooth_scrolling.js"></script>

<script src="libs/tinymace/prism.js"></script>

</html>